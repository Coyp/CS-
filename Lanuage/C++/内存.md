
# 内存相关

## 1.malloc()

1）定义: 内存是块状链表形式(一种元数据)：头部包括自身指针、下一块指针、内存大小  
2）申请: 从空闲的链表中拿到，若大小合适直接从空闲链表中取下；若大小太大，则根据申请大小修改内存头部一部分留在空闲链表，一部分拿下来  
3）释放: 扫描空闲链表寻找合适的位置，若存在相邻的空闲块，则进行合并，减少碎片

## 2.STL释放内存

1.含有reserve()/capacity()的容器才需要使用swap释放空间，vector\string\deque内存连续的符合，其余无效  
2.C11使用shrink_to_fit()释放

## allactor 设计

1 需要解决的问题

- 向 system heap 要空间
- 考虑多线程
- 考虑内存不足
- 碎片问题

2 operator::new() 等价 malloc()

## 模型

/////////  
栈  
//////////  
虚地址空间 -> 内存映射区  
//////////  
堆  
//////////  
.data // 已初始化的全局变量和局部静态变量, 分配空间, 数据保存在目标文件中  
.bss // 未初始化的全区变量和局部静态变量, 默认值为 0, 因此只预留位置(记录数据所需空间大小)不占空间  
///////// 数据段 -> 读/写存储器  
//////////  
.rodata // 只读数据段, const常量 或 字符串常量, 虚表   
.text // 机器代码  
///////// 代码段 -> 只读存储器  
