# 算法
## Paxos —— 选出唯一值

## Raft —— 主要竞选节点
### 数据同步
1.来自客户端的修改都会先发到leader  
2.由leader将修改发给所以的follow  
3.等超过一半的follow也进行了修改，才将修改提交  
4.此时leader会通知所有的follow也提交修改  

# 应用
## zookeeper 
1.内部选举    
1）首先每个server都会选自己为leader，并将票广播出去(myid, zxid)  
2）server收到其他票后与自己的票作对比，先比较zxid，再比较myid  
3）server选出较大的票后修改自己的票重新广播  
4）再次统计票数，当收到的某一台的票数超过一半，那么此台就被认定为leader  
 
## memcahced  
1.服务器之间并不能互相通信，因此分布式是通过客户端的一致性哈希算法保证  

## HDFS 
1.默认存储三个副本，其中两个副本放在同一个机架上，减少跨机架拷贝数据（受机架之间的带宽影响，同一个接入层下的服务器之间带宽为1Gb，不同接入层交换机下的服务器之间带宽小于1Gb）  



# 分布式存储
《大规模分布式存储系统：原理解析与架构实战》
## 第一章 概述
### 1.概念  
通过某种互相通信方式将集群内所有的存储空间资源整合，虚拟化并对外提供文件访问服务的文件系统  
### 2.分类  
1）分布式文件系统  
a.数据类型：Blob对象（Binary Large Object）、定长块、大文件  
2）分布式键值系统  
a.只提供对主键的CRUD（Create/read/update/delete）  
b.一致性哈希是分布式键值系统中的常用技术  
3）分布式表格系统  
以表格为单位组织数据，每个表格包括很多行，通过主键标识一行  
4）分布式数据库  
从单机数据库扩展而来，用于存储结构化数据  
## 第二章 单机存储系统
### 1.存储层次结构
1.存储系统的性能主要包括：吞吐量+访问延迟  
2.硬盘适合冷数据（大且访问不频繁），SSD适合热数据（访问频繁）  
### 2.单机存储引擎
1.哈希存储引擎  
1）特点：  
只有一个文件时可写的，用于数据追加 —— 活跃数据文件  
已经达到大小限制的文件 —— 老数据文件  
2）数据结构（以Bitcask为例）：  
key = 文件id + data位置 + data长度  
3）定期合并  
记录更新或者删除后，原来的记录成为了垃圾数据 ，定期执行合并操作  
4）快速恢复  
通过索引文件来提高内存重启后的哈希表重建速度，老数据合并操作时会产生索引文件（只存储data位置）  
2.B树存储引擎   
1）数据结构  
B+树：非叶子节点保存索引，叶子节点保存value  
3.LSM树存储引擎  
对数据的修改增量保持在内存中，达到指定的大小限制后将这些修改操作批量写入磁盘，读取时将磁盘的历史数据和内存中的修改合并  
### 5.故障恢复
1.操作日志  
1）重做日志：事务修改后的状态（用于正在执行的事务由于故障而掉电重启后进行恢复）  
2）回滚日志：事务修改前的状态（恢复到上一个事务状态）   
### 6.数据压缩
1.列存储  
1）定义：一列中的数据在存储介质中是连续存储的，行存储同理  
2）优点：查询时只有涉及到的列会被读取，如果是行的话需要读取所有  
## 第三章 分布式系统
### 1.基本概念  
1.异常  
1）服务器宕机 —— 考虑从持久化介质中恢复内存信息  
2）网络异常 ——   
3）磁盘故障 —— 数据存储到多台服务器上  
2.一致性  
副本是分布式存储系统容错技术的唯一手段，因此如何保证副本之间的一致性是个核心问题  
1）强一致性：像数据库那种    
2）最终一致性：在一定的时间窗口下，最终达到数据在系统中的一致性    




