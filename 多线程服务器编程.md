《Linux多线程服务端编程：使用muduo C++网络库》 笔记

# 第一章 C++多线程编程
## 线程安全的对象生命期管理
### 存在问题
1.对象中的mutex成员只能保证类内数据的原子性，不能保证对象正确销毁  
2.交换时死锁——swap(a,b) swap(b,a) 同时执行  
```c
void swap(Counter &a, Counter &b)
{
    MutexLockGuard aLock(a.mutex_);
    MutexLockGuard bLock(b.mutex_);
    /// ...
}
```
3.动态创建的对象通过指针访问，无论内存上的对象是否被销毁，单从指针上并得不到答案  
### 解决方案——智能指针（shared_prt/weak_ptr）  
1.简介  
shared_ptr：引用计数型 —— 可能产生循环引用  
weak_ptr::引用计数型，但是不增加对象的引用次数，像一个助手  
    .lock() // 返回一个shared_ptr 若对象已经释放则为空  
    .expired() // 检测对象是否已经被释放  
    构造shared_ptr()  
2.本质：  
使用栈上RAII技术来管理堆上资源（通过主动调用delete）  

# 第二章 muduo网络库
